var q=Object.defineProperty;var X=(e,t,i)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var T=(e,t,i)=>(X(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const M=new Map;var S=(e=>(e.Floor="floor.ogg",e.Tetris="tetris.mp3",e.LineClear="line-clear.mp3",e))(S||{});function c(e,t){if(!e)throw new Error(`assertion failed: ${t}`)}function G(){return Math.random()<.5?-1:1}function E(e,t){return c(e<t,"min should be less than max"),Math.floor(Math.random()*(t-e))+e}function A(e){return c(e.length>0,"choices array should not be empty, otherwise there's nothing to choose from"),e[E(0,e.length)]}function H(e){e.forEach(t=>{if(M.has(t))return;const i=new Audio(`/${t}`);i.volume=0,i.play().then(()=>{i.pause(),i.currentTime=0,i.volume=1}),M.set(t,i)})}function R(e,t=!1){if(!M.has(e)){const o=new Audio(`/${e}`);M.set(e,o)}const i=M.get(e);i.currentTime=0,i.loop=t,i.play()}function U(){const e=new Audio("/theme.mp3");e.loop=!0,e.volume=.5,e.pause();const t=()=>{e.play(),window.removeEventListener("click",t)};window.addEventListener("click",t)}var y=(e=>(e.AbsorbBottomShock="absorb-bottom-shock",e.LimitedShockLeft="limited-shock-left",e.LimitedShockRight="limited-shock-right",e.ScoreAlert="score-alert",e.StatHighlight="stat-highlight",e.RowClear="row-clear",e))(y||{}),j=(e=>(e.Score="score",e))(j||{});function V(){const e=[];for(let t=0;t<h.BOARD_ROWS;t++)for(let i=0;i<h.BOARD_COLS;i++){const o=document.createElement("div");o.classList.add(h.CELL_CLASS),o.dataset.row=t.toString(),o.dataset.col=i.toString(),o.dataset[h.CELL_HTML_DATASET_STATE_KEY]=l.Empty,e.push(o)}return e}function K(e,t){const i=J(e);i.classList.remove(...Object.values(l)),t!==l.Empty&&i.classList.add(t)}function J(e){const t=document.querySelector(`[data-row="${e.row}"][data-col="${e.col}"]`);if(t===null)throw new Error(`cell at (${e.row}, ${e.col}) not found`);return t}function L(e,t,i,o=0){return new Promise(s=>{e.style.animationName!==t&&(e.style.animationTimingFunction="ease",e.style.animationDuration=`${i}ms`,e.style.animationName=t,e.style.animationDelay=`${o}ms`,e.classList.add(t),setTimeout(()=>{e.style.animationName="",s()},o+i))})}function D(e){const t=document.getElementById(e);return c(t!==null,"stat elements should always exist"),t}function Q(e,t){D(e).innerText=t}function P(e){Q("score",e.score.toString()),e.board.iter((t,i)=>K(t,i))}class m{constructor(t,i={}){if(!(t instanceof Node))throw"Can't initialize VanillaTilt because "+t+" is not a Node.";this.width=null,this.height=null,this.clientWidth=null,this.clientHeight=null,this.left=null,this.top=null,this.gammazero=null,this.betazero=null,this.lastgammazero=null,this.lastbetazero=null,this.transitionTimeout=null,this.updateCall=null,this.event=null,this.updateBind=this.update.bind(this),this.resetBind=this.reset.bind(this),this.element=t,this.settings=this.extendSettings(i),this.reverse=this.settings.reverse?-1:1,this.resetToStart=m.isSettingTrue(this.settings["reset-to-start"]),this.glare=m.isSettingTrue(this.settings.glare),this.glarePrerender=m.isSettingTrue(this.settings["glare-prerender"]),this.fullPageListening=m.isSettingTrue(this.settings["full-page-listening"]),this.gyroscope=m.isSettingTrue(this.settings.gyroscope),this.gyroscopeSamples=this.settings.gyroscopeSamples,this.elementListener=this.getElementListener(),this.glare&&this.prepareGlare(),this.fullPageListening&&this.updateClientSize(),this.addEventListeners(),this.reset(),this.resetToStart===!1&&(this.settings.startX=0,this.settings.startY=0)}static isSettingTrue(t){return t===""||t===!0||t===1}getElementListener(){if(this.fullPageListening)return window.document;if(typeof this.settings["mouse-event-element"]=="string"){const t=document.querySelector(this.settings["mouse-event-element"]);if(t)return t}return this.settings["mouse-event-element"]instanceof Node?this.settings["mouse-event-element"]:this.element}addEventListeners(){this.onMouseEnterBind=this.onMouseEnter.bind(this),this.onMouseMoveBind=this.onMouseMove.bind(this),this.onMouseLeaveBind=this.onMouseLeave.bind(this),this.onWindowResizeBind=this.onWindowResize.bind(this),this.onDeviceOrientationBind=this.onDeviceOrientation.bind(this),this.elementListener.addEventListener("mouseenter",this.onMouseEnterBind),this.elementListener.addEventListener("mouseleave",this.onMouseLeaveBind),this.elementListener.addEventListener("mousemove",this.onMouseMoveBind),(this.glare||this.fullPageListening)&&window.addEventListener("resize",this.onWindowResizeBind),this.gyroscope&&window.addEventListener("deviceorientation",this.onDeviceOrientationBind)}removeEventListeners(){this.elementListener.removeEventListener("mouseenter",this.onMouseEnterBind),this.elementListener.removeEventListener("mouseleave",this.onMouseLeaveBind),this.elementListener.removeEventListener("mousemove",this.onMouseMoveBind),this.gyroscope&&window.removeEventListener("deviceorientation",this.onDeviceOrientationBind),(this.glare||this.fullPageListening)&&window.removeEventListener("resize",this.onWindowResizeBind)}destroy(){clearTimeout(this.transitionTimeout),this.updateCall!==null&&cancelAnimationFrame(this.updateCall),this.element.style.willChange="",this.element.style.transition="",this.element.style.transform="",this.resetGlare(),this.removeEventListeners(),this.element.vanillaTilt=null,delete this.element.vanillaTilt,this.element=null}onDeviceOrientation(t){if(t.gamma===null||t.beta===null)return;this.updateElementPosition(),this.gyroscopeSamples>0&&(this.lastgammazero=this.gammazero,this.lastbetazero=this.betazero,this.gammazero===null?(this.gammazero=t.gamma,this.betazero=t.beta):(this.gammazero=(t.gamma+this.lastgammazero)/2,this.betazero=(t.beta+this.lastbetazero)/2),this.gyroscopeSamples-=1);const i=this.settings.gyroscopeMaxAngleX-this.settings.gyroscopeMinAngleX,o=this.settings.gyroscopeMaxAngleY-this.settings.gyroscopeMinAngleY,s=i/this.width,n=o/this.height,r=t.gamma-(this.settings.gyroscopeMinAngleX+this.gammazero),a=t.beta-(this.settings.gyroscopeMinAngleY+this.betazero),u=r/s,d=a/n;this.updateCall!==null&&cancelAnimationFrame(this.updateCall),this.event={clientX:u+this.left,clientY:d+this.top},this.updateCall=requestAnimationFrame(this.updateBind)}onMouseEnter(){this.updateElementPosition(),this.element.style.willChange="transform",this.setTransition()}onMouseMove(t){this.updateCall!==null&&cancelAnimationFrame(this.updateCall),this.event=t,this.updateCall=requestAnimationFrame(this.updateBind)}onMouseLeave(){this.setTransition(),this.settings.reset&&requestAnimationFrame(this.resetBind)}reset(){this.onMouseEnter(),this.fullPageListening?this.event={clientX:(this.settings.startX+this.settings.max)/(2*this.settings.max)*this.clientWidth,clientY:(this.settings.startY+this.settings.max)/(2*this.settings.max)*this.clientHeight}:this.event={clientX:this.left+(this.settings.startX+this.settings.max)/(2*this.settings.max)*this.width,clientY:this.top+(this.settings.startY+this.settings.max)/(2*this.settings.max)*this.height};let t=this.settings.scale;this.settings.scale=1,this.update(),this.settings.scale=t,this.resetGlare()}resetGlare(){this.glare&&(this.glareElement.style.transform="rotate(180deg) translate(-50%, -50%)",this.glareElement.style.opacity="0")}getValues(){let t,i;this.fullPageListening?(t=this.event.clientX/this.clientWidth,i=this.event.clientY/this.clientHeight):(t=(this.event.clientX-this.left)/this.width,i=(this.event.clientY-this.top)/this.height),t=Math.min(Math.max(t,0),1),i=Math.min(Math.max(i,0),1);let o=(this.reverse*(this.settings.max-t*this.settings.max*2)).toFixed(2),s=(this.reverse*(i*this.settings.max*2-this.settings.max)).toFixed(2),n=Math.atan2(this.event.clientX-(this.left+this.width/2),-(this.event.clientY-(this.top+this.height/2)))*(180/Math.PI);return{tiltX:o,tiltY:s,percentageX:t*100,percentageY:i*100,angle:n}}updateElementPosition(){let t=this.element.getBoundingClientRect();this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,this.left=t.left,this.top=t.top}update(){let t=this.getValues();this.element.style.transform="perspective("+this.settings.perspective+"px) rotateX("+(this.settings.axis==="x"?0:t.tiltY)+"deg) rotateY("+(this.settings.axis==="y"?0:t.tiltX)+"deg) scale3d("+this.settings.scale+", "+this.settings.scale+", "+this.settings.scale+")",this.glare&&(this.glareElement.style.transform=`rotate(${t.angle}deg) translate(-50%, -50%)`,this.glareElement.style.opacity=`${t.percentageY*this.settings["max-glare"]/100}`),this.element.dispatchEvent(new CustomEvent("tiltChange",{detail:t})),this.updateCall=null}prepareGlare(){if(!this.glarePrerender){const t=document.createElement("div");t.classList.add("js-tilt-glare");const i=document.createElement("div");i.classList.add("js-tilt-glare-inner"),t.appendChild(i),this.element.appendChild(t)}this.glareElementWrapper=this.element.querySelector(".js-tilt-glare"),this.glareElement=this.element.querySelector(".js-tilt-glare-inner"),!this.glarePrerender&&(Object.assign(this.glareElementWrapper.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden","pointer-events":"none","border-radius":"inherit"}),Object.assign(this.glareElement.style,{position:"absolute",top:"50%",left:"50%","pointer-events":"none","background-image":"linear-gradient(0deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%)",transform:"rotate(180deg) translate(-50%, -50%)","transform-origin":"0% 0%",opacity:"0"}),this.updateGlareSize())}updateGlareSize(){if(this.glare){const t=(this.element.offsetWidth>this.element.offsetHeight?this.element.offsetWidth:this.element.offsetHeight)*2;Object.assign(this.glareElement.style,{width:`${t}px`,height:`${t}px`})}}updateClientSize(){this.clientWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.clientHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}onWindowResize(){this.updateGlareSize(),this.updateClientSize()}setTransition(){clearTimeout(this.transitionTimeout),this.element.style.transition=this.settings.speed+"ms "+this.settings.easing,this.glare&&(this.glareElement.style.transition=`opacity ${this.settings.speed}ms ${this.settings.easing}`),this.transitionTimeout=setTimeout(()=>{this.element.style.transition="",this.glare&&(this.glareElement.style.transition="")},this.settings.speed)}extendSettings(t){let i={reverse:!1,max:15,startX:0,startY:0,perspective:1e3,easing:"cubic-bezier(.03,.98,.52,.99)",scale:1,speed:300,transition:!0,axis:null,glare:!1,"max-glare":1,"glare-prerender":!1,"full-page-listening":!1,"mouse-event-element":null,reset:!0,"reset-to-start":!0,gyroscope:!0,gyroscopeMinAngleX:-45,gyroscopeMaxAngleX:45,gyroscopeMinAngleY:-45,gyroscopeMaxAngleY:45,gyroscopeSamples:10},o={};for(var s in i)if(s in t)o[s]=t[s];else if(this.element.hasAttribute("data-tilt-"+s)){let n=this.element.getAttribute("data-tilt-"+s);try{o[s]=JSON.parse(n)}catch{o[s]=n}}else o[s]=i[s];return o}static init(t,i){t instanceof Node&&(t=[t]),t instanceof NodeList&&(t=[].slice.call(t)),t instanceof Array&&t.forEach(o=>{"vanillaTilt"in o||(o.vanillaTilt=new m(o,i))})}}typeof document<"u"&&(window.VanillaTilt=m,m.init(document.querySelectorAll("[data-tilt]")));const C=[];function Z(){let e=0;const t=i=>{const o=i-e;e=i;for(const[s,n]of C.entries()){if(n.lifetime-=o,n.lifetime<=0){n.$element.remove(),C.splice(s,1);continue}const r=n.lifetime/n.maxLifetime;n.position.x+=n.velocity.x*o,n.position.y+=n.velocity.y*o,n.$element.style.top=`${n.position.y}px`,n.$element.style.left=`${n.position.x}px`,n.$element.style.opacity=`${n.opacityMin+r*(n.opacityMax-n.opacityMin)}`}requestAnimationFrame(t)};requestAnimationFrame(t)}function O(e){var s,n;const t=()=>Math.random()*e.velocityFactor*G(),i=E(e.countMin,e.countMax),o=r=>{const a=r*Math.PI/180;return{x:Math.cos(a),y:Math.sin(a)}};for(let r=0;r<i;r++){const a=document.createElement("div"),u=E(e.radiusMin,e.radiusMax),d=(u-e.radiusMin)/(e.radiusMax-e.radiusMin),f=A(e.colors);a.style.width=`${u}px`,a.style.height=`${u}px`,a.style.filter=`blur(${e.blurMin+d*(e.blurMax-e.blurMin)}px)`,a.style.backgroundColor=f,a.style.boxShadow=`0 0 10px ${f}`;for(const F of e.classNames)a.classList.add(F);const w=E(e.lifetimeMin,e.lifetimeMax),x=((s=e.position)==null?void 0:s.x)??E(0,window.innerWidth),Y=((n=e.position)==null?void 0:n.y)??E(0,window.innerHeight),$=e.directionDegrees===void 0?{x:t(),y:t()}:o(e.directionDegrees);C.push({position:{x,y:Y},velocity:$,radius:0,color:f,maxLifetime:w,lifetime:w,$element:a,opacityMin:e.opacityMin,opacityMax:e.opacityMax}),document.body.appendChild(a)}}function tt(){U(),Z(),m.init(document.querySelector(".grid"),{max:5,speed:200}),O({countMin:30,countMax:40,lifetimeMin:5e3,lifetimeMax:6e8,radiusMin:5,radiusMax:30,blurMin:1,blurMax:3,classNames:["particle"],velocityFactor:.02,opacityMin:0,opacityMax:.1,colors:["#fff"]})}function et(){R(S.Floor),L(document.querySelector(h.BOARD_SELECTOR),y.AbsorbBottomShock,400),O({countMin:10,countMax:15,lifetimeMin:1e3,lifetimeMax:2500,radiusMin:3,radiusMax:10,blurMin:1,blurMax:2,classNames:["particle","action"],velocityFactor:.2,opacityMin:0,opacityMax:.9,colors:["#fff"]})}function it(){R(S.Tetris),L(document.querySelector(".score-alert"),y.ScoreAlert,3e3),O({countMin:40,countMax:50,lifetimeMin:1e3,lifetimeMax:4e3,radiusMin:10,radiusMax:15,blurMin:0,blurMax:2,classNames:["particle","tetris"],velocityFactor:.5,opacityMin:.2,opacityMax:.5,colors:["#6666ff","#0099ff","#00ff00","#ff3399"]})}function ot(e){const t=o=>Array.from(document.querySelectorAll(`[data-row='${o}']`));for(const[o,s]of e.entries()){const n=t(s);for(const[r,a]of n.entries()){const u=(o*e.length+r)*15;L(a,y.RowClear,100,u)}}}class g{constructor(t,i,o=l.Empty){T(this,"rows");T(this,"cols");T(this,"inner");c(t>0,"matrix should have at least one row"),c(i>0,"matrix should have at least one column"),this.rows=t,this.cols=i,this.inner=Array.from({length:t},()=>Array(i).fill(o));const s=this.inner.length,n=this.inner[0].length;c(s===t,"created rows should match requested rows"),c(n===i,"created cols should match requested cols")}iter(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.cols;o++)t({row:i,col:o},this.inner[i][o])}transform(t){const i=this.clone();return i.iter((o,s)=>{i.inner[o.row][o.col]=t(o,s)}),i}set(t,i){c(t.row>=0&&t.row<this.rows,"row should be within bounds"),c(t.col>=0&&t.col<this.cols,"col should be within bounds");const o=this.clone();return o.inner[t.row][t.col]=i,o}unwrap(){return this.inner}clearMask(t,i){c(t.rows+i.row<=this.rows,"mask matrix should have fewer rows"),c(t.cols+i.col<=this.cols,"mask matrix should have fewer cols");const o=this.clone();return t.iter(({row:s,col:n},r)=>{r!==l.Empty&&(o.inner[s+i.row][n+i.col]=l.Empty)}),o}insert(t,i){c(t.rows+i.row<=this.rows,"insertion matrix should have fewer rows"),c(t.cols+i.col<=this.cols,"insertion matrix should have fewer cols");const o=this.clone();return t.iter(({row:s,col:n},r)=>{r!==l.Empty&&(o.inner[s+i.row][n+i.col]=r)}),o}clearRowAndCollapse(t){c(t>=0&&t<this.rows,"row should be within bounds");const i=this.clone();for(let o=t;o>0;o--)i.inner[o]=i.inner[o-1];return i.inner[0]=Array(this.cols).fill(l.Empty),i}clone(){const t=new g(this.rows,this.cols);return this.iter(({row:i,col:o},s)=>{t.inner[i][o]=s}),t}rotateClockwise(){const t=new g(this.cols,this.rows);return this.iter(({row:i,col:o},s)=>{const n=o,r=this.rows-i-1;t.inner[n][r]=s}),t}rotateCounterClockwise(){const t=new g(this.cols,this.rows);return this.iter(({row:i,col:o},s)=>{const n=this.cols-o-1,r=i;t.inner[n][r]=s}),t}}class p{static getRandomColorState(){const t=[l.Red,l.Green,l.LightGreen,l.Pink,l.Orange,l.Yellow,l.Purple];return A(t)}static get square(){return new g(2,2,this.getRandomColorState())}static get straight(){return new g(4,1,this.getRandomColorState())}static get t(){return new g(2,3,this.getRandomColorState()).set({row:1,col:0},l.Empty).set({row:1,col:2},l.Empty)}static get l(){return new g(3,2,this.getRandomColorState()).set({row:0,col:1},l.Empty).set({row:1,col:1},l.Empty)}static get skew(){return new g(2,3,this.getRandomColorState()).set({row:0,col:0},l.Empty).set({row:1,col:2},l.Empty)}static get random(){return A([()=>p.square,()=>p.straight,()=>p.t,()=>p.l,()=>p.skew])()}}var v=(e=>(e[e.InPlace=0]="InPlace",e[e.IntoProjection=1]="IntoProjection",e))(v||{});class I{constructor(t,i,o,s,n,r,a){this.board=t,this.tetromino=i,this.tetrominoPosition=o,this.projectionPosition=s,this.fallTickInterval=n,this.score=r,this.isPaused=a}modify(t){return t.tetromino!==void 0&&t.tetromino.iter((i,o)=>c(o!==l.Projection,"state tetromino should not contain projection cells")),new I(t.board||this.board.clone(),t.tetromino||this.tetromino.clone(),t.tetrominoPosition||{...this.tetrominoPosition},t.projectionPosition||{...this.projectionPosition},t.fallTickInterval||this.fallTickInterval,t.score||this.score,t.isPaused||this.isPaused)}placeTetromino(t){const i=t===0?this.tetrominoPosition:this.projectionPosition,o=this.tetromino.clone();return this.modify({board:this.board.insert(o,i)})}refreshTetromino(){const t=p.random,i={row:0,col:k(this.board.cols,t.cols)};return this.modify({tetromino:t,tetrominoPosition:i})}clearTetrominoAndProjection(){return this.modify({board:this.board.clearMask(this.tetromino,this.tetrominoPosition).clearMask(this.tetromino,this.projectionPosition)})}updateProjection(){const t={row:ht(this.board,this.tetromino,this.tetrominoPosition),col:this.tetrominoPosition.col},i=N(this.tetromino),o=this.board.insert(i,t);return this.modify({board:o,projectionPosition:t})}addTetrominoPositionDelta(t){return this.modify({tetrominoPosition:{row:this.tetrominoPosition.row+t.row,col:this.tetrominoPosition.col+t.col}})}clone(){return this.modify({})}choose(t){return t||this}}function nt(e){const t={row:1,col:0},i=B(e.board,e.tetromino,e.tetrominoPosition,t);if(i===b.NoCollision)return e.clearTetrominoAndProjection().addTetrominoPositionDelta(t).updateProjection().placeTetromino(v.InPlace);if(i===b.Ceiling)return rt(e),e;c(i===b.WallsOrFloorOrOtherTetromino,"collision check result should only be composed of three variants");const o=e.placeTetromino(v.InPlace).refreshTetromino().updateProjection();return z(o,e.tetrominoPosition.row,e.tetromino.rows)}function z(e,t,i){c(i>=0,"span should be greater than or equal to zero"),c(t>=0,"placement row should be greater than or equal to zero");const o=i-1,s=t+o,n=e.clone();c(s<n.board.rows,"end row should not be out of bounds (it's more than the board's rows)"),et();const r=[];for(let d=t;d<=s;d++)n.board.unwrap()[d].every(w=>w!==l.Empty&&w!==l.Projection)&&r.push(d);r.length>0&&ot(r);const a=r.reduce((d,f)=>d.clearRowAndCollapse(f),n.board.clone()),u=n.modify({board:a});return r.length>0?st(r.length,u.updateProjection()):u}function st(e,t){c(e>0,"at least one row should be cleared when calling this function"),c(e<=4,"at most 4 rows should be cleared by any single move"),e===4?it():R(S.LineClear);const i=h.ROW_SCORE*e,o=t.score+i,s=ct(t.fallTickInterval,e);return L(D(j.Score),y.StatHighlight,100),t.modify({score:o,fallTickInterval:e>0?s:void 0})}function rt(e){alert(`Game over! Score: ${e.score}`),window.location.reload()}function _(e,t){const i={row:0,col:t?-1:1};if(W(i,e.board,e.tetromino,e.tetrominoPosition))return e.clearTetrominoAndProjection().addTetrominoPositionDelta(i).updateProjection().placeTetromino(v.InPlace);const s=t?y.LimitedShockLeft:y.LimitedShockRight,n=document.querySelector(h.BOARD_SELECTOR);return L(n,s,300),null}function lt(e){const t=e.clearTetrominoAndProjection().placeTetromino(v.IntoProjection).refreshTetromino().updateProjection();return z(t,e.projectionPosition.row,e.tetromino.rows)}function at(e){const t=e.tetromino.rotateClockwise();return B(e.board,t,e.tetrominoPosition)!==b.NoCollision?null:e.clearTetrominoAndProjection().modify({tetromino:t}).updateProjection().placeTetromino(v.InPlace)}const h={BOARD_SELECTOR:"#board",CELL_CLASS:"cell",BOARD_COLS:10,BOARD_ROWS:20,CELL_HTML_DATASET_STATE_KEY:"tag",INITIAL_FALL_TICK_INTERVAL:700,ROW_SCORE:100,SPEED_INCREASE_PERCENT_PER_ROW:5,MIN_FALL_INVERVAL:250,IS_DEBUG_MODE:!1,IS_DEBUG_PAUSED:!1,IS_DEBUG_COORDS_VISIBLE:!1,DEBUG_ONLY_STRAIGHT_TETROMINOS:!0,DEBUG_PLAY_MUSIC:!1};var l=(e=>(e.Empty="empty",e.Projection="projection",e.Red="red",e.Green="green",e.LightGreen="lightgreen",e.Pink="pink",e.Orange="orange",e.Yellow="yellow",e.Purple="purple",e))(l||{}),b=(e=>(e[e.NoCollision=0]="NoCollision",e[e.WallsOrFloorOrOtherTetromino=1]="WallsOrFloorOrOtherTetromino",e[e.Ceiling=2]="Ceiling",e))(b||{});function N(e){return e.transform((t,i)=>i==="empty"?i:"projection")}function ct(e,t){const i=t*h.SPEED_INCREASE_PERCENT_PER_ROW/100;return Math.max(h.MIN_FALL_INVERVAL,e-e*i)}function k(e,t){const i=Math.floor(e/2),o=Math.floor(t/2);return i-o}function B(e,t,i,o={row:0,col:0}){const s=e.clearMask(t,i),n={row:i.row+o.row,col:i.col+o.col};if(n.col<0||n.col+t.cols>s.cols)return 1;if(n.row+t.rows>s.rows)return 1;let r=!1;return t.iter(({row:a,col:u},d)=>{if(d==="empty"||d==="projection")return;const f=a+n.row,w=u+n.col,x=s.unwrap()[f][w];x!=="empty"&&x!=="projection"&&(r=!0)}),i.row===0&&r?2:r?1:0}function W(e,t,i,o){return B(t,i,o,e)===0}function ht(e,t,i){const o={...i};for(;W({row:1,col:0},e,t,o);)o.row+=1;return o.row}function dt(){const e=p.random,t=k(h.BOARD_COLS,e.cols),i={row:0,col:t},o={row:h.BOARD_ROWS-e.rows,col:t},s=new g(h.BOARD_ROWS,h.BOARD_COLS).insert(N(e),o).insert(e,i);return new I(s,e,i,o,h.INITIAL_FALL_TICK_INTERVAL,0,h.IS_DEBUG_MODE)}window.addEventListener("load",()=>{console.log("Game logic loaded");const e=document.querySelector(h.BOARD_SELECTOR);V().forEach(s=>e.appendChild(s)),console.log(`Initialized HTML board (${h.BOARD_COLS}x${h.BOARD_ROWS})`),tt(),H(Object.values(S));let t=dt();P(t),console.log("Initial render");const i=s=>setInterval(()=>{t=nt(t),P(t)},s);let o=t.isPaused?-1:i(t.fallTickInterval);window.addEventListener("keydown",s=>{let n=null;switch(s.key){case"ArrowLeft":n=t.choose(_(t,!0));break;case"ArrowRight":n=t.choose(_(t,!1));break;case"ArrowUp":n=t.choose(at(t));break;case" ":n=t.choose(lt(t));break}!t.isPaused&&n!==null&&(n.fallTickInterval!==t.fallTickInterval&&(clearInterval(o),o=i(n.fallTickInterval)),t=n,P(t))})});
